<div class="card">
    <div class="card-content">
        <h4><%= "#{@item.name} Recent Submissions "%></h4>
        
        <table class = "striped highlight">

            <% if @submissions.empty? %>
                <p>There are no submissions for this item.</p>
            <% else %>
                <thead>
                    <th>Date Completed</th>
                    <th>File</th>
                </thead>
                <% for submission in @submissions %>
                <tr>
                    <td><%= link_to "#{submission.date_completed.strftime("%m/%d/%y")}", submission_path(submission) %></td>
                    <% if !submission.nil? && !submission.file.nil? %>
                        <td> <%= link_to "#{submission.filename}", rails_blob_path(submission.file, disposition: "attachment") %> </td>
                    <% else %>
                        <td>No linked files.</td> 
                    <% end %>
                </tr>
                <% end%>
            <% end %>

        </table><br>

        

        
        <% if @assignments.any? { |assignment| assignment.item == @item && !assignment.completion }%>
            <% if !current_user.nil? && current_user.role?(:case_worker) %>
                <%= link_to "Add a New Submission", new_submission_path(item_id: @item.id, parent_id: @parent.id), class: 'waves-effect waves-light btn btn-alert' %>
            <% elsif !current_user.nil? && current_user.role?(:parent) %>
                <%= link_to "Add a New Submission", new_submission_path(item_id: @item.id, parent_id: @current_user.parent.id), class: 'waves-effect waves-light btn btn-alert' %>
            <% end %>
        <% end %>

        
        
    </div>
</div>
    

<% if current_user.role?(:parent) && can?(:destroy, submission) && submission%>
  <%= link_to submission_path(submission), method: :delete, data: { confirm: "Are you sure you want to permanently delete this submission?" }, class: 'waves-effect waves-light btn btn-alert' do %>
    <%= "Delete Submission" %>
  <% end %>
<% end %>


<% if current_user.role?(:case_worker) && can?(:destroy, submission) && submission %>
  <%= link_to submission_path(submission), method: :delete, data: { confirm: "Are you sure you want to permanently delete this submission?" }, class: 'waves-effect waves-light btn btn-alert' do %>
    <%= "Delete Submission" %>
  <% end %>
<% end %>